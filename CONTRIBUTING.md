# How to contribute to **Child Health Tracker**

Thank you for your interest in contributing to the **Child Health Tracker** - a UNICEF partnership to improve early childhood development!

This page explains forms of contribution, how to set up the project locally, how to submit a pull-request, create issues and much more.

## Types of contribution

### Code

If you would like to help with a code contribution, either a new feature or a contribution on an open issue, it would be great if you are familiar with the technologies used. Our project mainly uses Python and the Django framework, but other open-source tools used are also listed in the [home page](README.md#built-with).

When you feel ready, fork this repository, [**create a new branch**](https://support.atlassian.com/bitbucket-cloud/docs/branch-a-repository/), follow the instructions below to create a [local development environment](CONTRIBUTING.md#how-to-create-a-development-environment) and submit your contributions via [pull requests](CONTRIBUTING.md#how-to-submit-a-pull-request)!

It is critical that your code contribution is covered by testing using the `pytest` framework. We recommend following a [Test-driven development](https://en.wikipedia.org/wiki/Test-driven_development) approach. The minimum code coverage of 80% is implemented by an automated Bitbucket Pipelines evaluation, which checks the code with every pull-request.

Keep an eye on the development best practices and codestyle used in the project, this will ensure that your contribution is reviewed and accepted faster.

### Bug reporting

Do you want to report a new bug you found or search for existing problems? Check the [Jira issues](https://bitbucket.org/ptmtech/central-database/jira) page!

If you are reporting a new issue, please be as detailed as you can. Include screenshots, error codes and preferably a [minimal reproducible example](https://en.wikipedia.org/wiki/Minimal_reproducible_example).

### Documentation

If you believe that some part of the project is not documented or that the documentation could be improved, you can help us with that!

Python code documentation can be generated by [Sphinx](https://www.sphinx-doc.org/) from docstrings in Numpy or Google format. In addition, documentation pages can be manually added in `rst` format to supplement other aspects of the project documentation inside the [docs folder](central_database/docs).

## How to create a development environment

### Pre-requisites

- [Visual Studio Code](https://code.visualstudio.com/) editor
- [Docker](https://www.docker.com/get-started/) for your operating system
- [Git](https://git-scm.com/downloads)
- [pyenv](https://github.com/pyenv/pyenv) for managing Python versions

### Clone repository

```bash
git clone git@bitbucket.org:ptmtech/central-database.git
````

### Python Setup

We use pyenv to manage Python versions. Install the required Python version:

```bash
pyenv install 3.9.5
pyenv local 3.9.5
```


### Docker Setup

The project uses Docker for local development. To set up the development environment:

1. Make sure Docker is installed and running on your system.
2. Navigate to the project root directory.
3. Run the following command to build and start the containers:

```
bash
make start-all
```


This will create:

- A Django microservice on [localhost:8000](http://localhost:8000/)
- A HL7 FHIR API on [localhost:8080](http://localhost:8080/)
- Documentation on [localhost:9000](http://localhost:9000/)

### Managing dependencies

This project uses `pip` for dependency management. To install dependencies, use:

```
bash
pip install -r requirements.txt
pip install -r requirements-local.txt
```
## Using Google Healthcare API and FHIR Store Locally

If you want to use Google Healthcare API and FHIR Store in your local development environment, you'll need to authenticate with Google Cloud. Follow these steps:

1. Install the [Google Cloud SDK](https://cloud.google.com/sdk/docs/install) if you haven't already.

2. Authenticate with Google Cloud by running the following command:

   ```
   gcloud auth application-default login
   ```

   This will open a browser window where you can log in with your Google account that has access to the project.

3. After successful authentication, the application will use these credentials to access Google Cloud services.

4. Make sure the following environment variables are set in your `.env` file:

   ```
   USE_HEALTHCARE_API=True
   USE_FHIR_STORE=True
   FHIR_PROJECT_ID=your-project-id
   FHIR_LOCATION=your-project-location
   ```

   Replace `your-project-id` and `your-project-location` with your actual Google Cloud project ID and location.

Now your local environment should be able to interact with Google Healthcare API and FHIR Store.

### Generating FHIR synthetic data

While we don't provide synthetic data, you can generate your own FHIR data using the [Synthea](https://github.com/synthetichealth/synthea) patient generator. Here's a guide on how to do it:

1. Clone the Synthea repository:
   ```bash
   git clone https://github.com/synthetichealth/synthea.git
   cd synthea
   ```

2. Build Synthea:
   ```bash
   ./gradlew build
   ```

3. Generate FHIR data:
   ```bash
   ./run_synthea -p 1000 -a 0-15
   ```
   This will generate data for 1000 patients aged 0-15 years.

4. The generated FHIR data will be in the `output/fhir` directory.

5. You can then use this data to populate your local FHIR server.

### Useful Make commands

Our project uses a Makefile to simplify common tasks. Here are some useful commands:

- `make setup`: Run migrations, load initial data, and create a superuser
- `make start-all`: Start all Docker containers
- `make stop-all`: Stop all Docker containers
- `make backend-start`: Start only the backend container
- `make frontend-start`: Start only the frontend container
- `make test`: Run backend tests
- `make clean`: Remove all Docker containers and volumes

For a full list of available commands, refer to the Makefile in the project root.

## How to submit a pull request

Pull requests are the way to submit your collaboration to the project. If you are new to collaborations, Bitbucket's [pull requests guide](https://www.atlassian.com/git/tutorials/making-a-pull-request) can help you.

Your pull request should carefully describe the modifications you have made. Describe the purpose of the feature and the rationale used to propose the solution as presented. Whenever possible, include screenshots of visual modifications and a step-by-step description to test and observe what has been modified.

## Code style and good-practices

### Codestyle

We follow PEP8, the standard style guide for Python code. When you are developing, keep an eye on the alerts in the "Problems" tab of VS Code and check periodically for various style issues with the `flake8` command.

### Automated tests

We use [pytest](https://docs.pytest.org/) as the framework for building and executing automated tests.
The minimum code coverage of 80% is implemented by an automated Bitbucket Pipelines evaluation,
which checks the code with every pull-request.

### Documentation

Please document your contribution in different aspects. Write docstrings for your code and create pages dedicated to other types of contributions such as references and usage guides.

Python code documentation can be generated by [Sphinx](https://www.sphinx-doc.org/) from docstrings in Numpy or
Google format. Pages can be manually added in `rst` format to supplement other aspects of the
project documentation.

## Code review process

Your code will be reviewed by the code maintainers. Currently, approval by 2 reviewers, including a default reviewer, is required. In addition, automated tests will be checked to see if they pass and are above the established coverage threshold. The necessary discussions will be held directly in the open pull request. We will try to make the process as fast as possible, we know how important this is for the community!